#!/bin/bash

declare -A num_list
declare -A chr_list

#le bleme c'est que l'on remplace , et chiffres ...
reg_spe='s/\n/\[\.ENTER\]/g; s/\r/\[\.ENTER\]/g; s/\r\n/\[\.ENTER\]/g; s/\t/\[\.TAB\]/g;'
special='s/\[\.ENTER\]/,2,40,0,3,10,0,1,40,0/g; s/\[\.ECHAP\]/,2,41,0,3,10,0,1,41,0/g; s/\[\.BACK\]/,2,42,0,3,10,0,1,42,0/g; s/\[\.TAB\]/,2,43,0,3,10,0,1,43,0/g; s/\[\.SPACE\]/,2,44,0,3,10,0,1,44,0/g; s/\[\.LOCK\]/,2,57,0,3,10,0,1,57,0/g; s/\[\.F1\]/,2,58,0,3,10,0,1,58,0/g; s/\[\.F2\]/,2,59,0,3,10,0,1,59,0/g; s/\[\.F3\]/,2,60,0,3,10,0,1,60,0/g; s/\[\.F4\]/,2,61,0,3,10,0,1,61,0/g; s/\[\.F5\]/,2,62,0,3,10,0,1,62,0/g; s/\[\.F6\]/,2,63,0,3,10,0,1,63,0/g; s/\[\.F7\]/,2,64,0,3,10,0,1,64,0/g; s/\[\.F8\]/,2,65,0,3,10,0,1,65,0/g; s/\[\.F9\]/,2,66,0,3,10,0,1,66,0/g; s/\[\.F10\]/,2,67,0,3,10,0,1,67,0/g; s/\[\.F11\]/,2,68,0,3,10,0,1,68,0/g; s/\[\.F12\]/,2,69,0,3,10,0,1,69,0/g; s/\[\.INSERT\]/,2,73,0,3,10,0,1,73,0/g; s/\[\.HOME\]/,2,74,0,3,10,0,1,74,0/g; s/\[\.PGUP\]/,2,75,0,3,10,0,1,75,0/g; s/\[\.DELL\]/,2,76,0,3,10,0,1,76,0/g; s/\[\.END\]/,2,77,0,3,10,0,1,77,0/g; s/\[\.PGON\]/,2,78,0,3,10,0,1,78,0/g; s/\[\.RIGHT\]/,2,79,0,3,10,0,1,79,0/g; s/\[\.LEFT\]/,2,80,0,3,10,0,1,80,0/g; s/\[\.DOWN\]/,2,81,0,3,10,0,1,81,0/g; s/\[\.UP\]/,2,82,0,3,10,0,1,82,0/g; s/\[\.CTRL\]/,2,224,0,3,10,0,1,224,0/g; s/\[\.MAJ\]/,2,225,0,3,10,0,1,225,0/g; s/\[\.ALT\]/,2,226,0,3,10,0,1,226,0/g; s/\[\.WIN\]/,2,227,0,3,10,0,1,227,0/g; s/\[\.CTRLR\]/,2,228,0,3,10,0,1,228,0/g; s/\[\.MAJR\]/,2,229,0,3,10,0,1,229,0/g; s/\[\.ALTR\]/,2,230,0,3,10,0,1,230,0/g; s/\[\.PS\]/,2,3639,0,3,10,0,1,3639,0/g;'

num_list=( [',']=',2,54,0,3,10,0,1,54,0' ['1']=',2,30,0,3,10,0,1,30,0' ['2']=',2,31,0,3,10,0,1,31,0' ['3']=',2,32,0,3,10,0,1,32,0' ['4']=',2,33,0,3,10,0,1,33,0' ['5']=',2,34,0,3,10,0,1,34,0' ['6']=',2,35,0,3,10,0,1,35,0' ['7']=',2,36,0,3,10,0,1,36,0' ['8']=',2,37,0,3,10,0,1,37,0' ['9']=',2,38,0,3,10,0,1,38,0' ['0']=',2,39,0,3,10,0,1,39,0' )
chr_list=( ['a']=',2,4,0,3,10,0,1,4,0' ['b']=',2,5,0,3,10,0,1,5,0' ['c']=',2,6,0,3,10,0,1,6,0' ['d']=',2,7,0,3,10,0,1,7,0' ['e']=',2,8,0,3,10,0,1,8,0' ['f']=',2,9,0,3,10,0,1,9,0' ['g']=',2,10,0,3,10,0,1,10,0' ['h']=',2,11,0,3,10,0,1,11,0' ['i']=',2,12,0,3,10,0,1,12,0' ['j']=',2,13,0,3,10,0,1,13,0' ['k']=',2,14,0,3,10,0,1,14,0' ['l']=',2,15,0,3,10,0,1,15,0' ['m']=',2,16,0,3,10,0,1,16,0' ['n']=',2,17,0,3,10,0,1,17,0' ['o']=',2,18,0,3,10,0,1,18,0' ['p']=',2,19,0,3,10,0,1,19,0' ['q']=',2,20,0,3,10,0,1,20,0' ['r']=',2,21,0,3,10,0,1,21,0' ['s']=',2,22,0,3,10,0,1,22,0' ['t']=',2,23,0,3,10,0,1,23,0' ['u']=',2,24,0,3,10,0,1,24,0' ['v']=',2,25,0,3,10,0,1,25,0' ['w']=',2,26,0,3,10,0,1,26,0' ['x']=',2,27,0,3,10,0,1,27,0' ['y']=',2,28,0,3,10,0,1,28,0' ['z']=',2,29,0,3,10,0,1,29,0' ['-']=',2,45,0,3,10,0,1,45,0' ['=']=',2,46,0,3,10,0,1,46,0' ['[']=',2,47,0,3,10,0,1,47,0' [']']=',2,48,0,3,10,0,1,48,0' ['\']=',2,49,0,3,10,0,1,49,0' [';']=',2,51,0,3,10,0,1,51,0' ["'"]=',2,52,0,3,10,0,1,52,0' ['`']=',2,53,0,3,10,0,1,53,0' ['.']=',2,55,0,3,10,0,1,55,0' ['/']=',2,56,0,3,10,0,1,56,0' ['A']=',2,225,0,2,4,0,3,10,0,1,4,0,1,225,0' ['B']=',2,225,0,2,5,0,3,10,0,1,5,0,1,225,0' ['C']=',2,225,0,2,6,0,3,10,0,1,6,0,1,225,0' ['D']=',2,225,0,2,7,0,3,10,0,1,7,0,1,225,0' ['E']=',2,225,0,2,8,0,3,10,0,1,8,0,1,225,0' ['F']=',2,225,0,2,9,0,3,10,0,1,9,0,1,225,0' ['G']=',2,225,0,2,10,0,3,10,0,1,10,0,1,225,0' ['H']=',2,225,0,2,11,0,3,10,0,1,11,0,1,225,0' ['I']=',2,225,0,2,12,0,3,10,0,1,12,0,1,225,0' ['J']=',2,225,0,2,13,0,3,10,0,1,13,0,1,225,0' ['K']=',2,225,0,2,14,0,3,10,0,1,14,0,1,225,0' ['L']=',2,225,0,2,15,0,3,10,0,1,15,0,1,225,0' ['M']=',2,225,0,2,16,0,3,10,0,1,16,0,1,225,0' ['N']=',2,225,0,2,17,0,3,10,0,1,17,0,1,225,0' ['O']=',2,225,0,2,18,0,3,10,0,1,18,0,1,225,0' ['P']=',2,225,0,2,19,0,3,10,0,1,19,0,1,225,0' ['Q']=',2,225,0,2,20,0,3,10,0,1,20,0,1,225,0' ['R']=',2,225,0,2,21,0,3,10,0,1,21,0,1,225,0' ['S']=',2,225,0,2,22,0,3,10,0,1,22,0,1,225,0' ['T']=',2,225,0,2,23,0,3,10,0,1,23,0,1,225,0' ['U']=',2,225,0,2,24,0,3,10,0,1,24,0,1,225,0' ['V']=',2,225,0,2,25,0,3,10,0,1,25,0,1,225,0' ['W']=',2,225,0,2,26,0,3,10,0,1,26,0,1,225,0' ['X']=',2,225,0,2,27,0,3,10,0,1,27,0,1,225,0' ['Y']=',2,225,0,2,28,0,3,10,0,1,28,0,1,225,0' ['Z']=',2,225,0,2,29,0,3,10,0,1,29,0,1,225,0' ['!']=',2,225,0,2,30,0,3,10,0,1,30,0,1,225,0' ['@']=',2,225,0,2,31,0,3,10,0,1,31,0,1,225,0' ['#']=',2,225,0,2,32,0,3,10,0,1,32,0,1,225,0' ['$']=',2,225,0,2,33,0,3,10,0,1,33,0,1,225,0' ['%']=',2,225,0,2,34,0,3,10,0,1,34,0,1,225,0' ['^']=',2,225,0,2,35,0,3,10,0,1,35,0,1,225,0' ['&']=',2,225,0,2,36,0,3,10,0,1,36,0,1,225,0' ['*']=',2,225,0,2,37,0,3,10,0,1,37,0,1,225,0' ['(']=',2,225,0,2,38,0,3,10,0,1,38,0,1,225,0' [')']=',2,225,0,2,39,0,3,10,0,1,39,0,1,225,0' ['_']=',2,225,0,2,45,0,3,10,0,1,45,0,1,225,0' ['+']=',2,225,0,2,46,0,3,10,0,1,46,0,1,225,0' ['{']=',2,225,0,2,47,0,3,10,0,1,47,0,1,225,0' ['}']=',2,225,0,2,48,0,3,10,0,1,48,0,1,225,0' ['|']=',2,225,0,2,49,0,3,10,0,1,49,0,1,225,0' [':']=',2,225,0,2,51,0,3,10,0,1,51,0,1,225,0' ['"']=',2,225,0,2,52,0,3,10,0,1,52,0,1,225,0' ['~']=',2,225,0,2,53,0,3,10,0,1,53,0,1,225,0' ['<']=',2,225,0,2,54,0,3,10,0,1,54,0,1,225,0' ['>']=',2,225,0,2,55,0,3,10,0,1,55,0,1,225,0' ['?']=',2,225,0,2,56,0,3,10,0,1,56,0,1,225,0' )

function err()
{
    echo "ERROR: ${1}"
    exit 1
}

function help()
{
cat <<USAGE

    Usage: $0 <input file path>

USAGE
}

function get_args()
{
    if [ $# -ne 1 ]; then help; exit 1; fi

    in="$1"
    if [[ ! -r $in ]]; then
        err "Unable to read '${in}'"
    fi
}

function replace_list()
{
    local _str="$1"
    local _list="$2"
    local _buff=""
    local _char=""

    while read -n1 chr; do
      _char="${_list}[\"$chr\"]"

      if [[ ${!_char} ]]; then _buff+="${!_char}"
      else _buff+="${chr}"; fi
    done < <(echo -n "$_str")

    echo "$_buff"
}

function render()
{
    local _buff="$(cat ${in})"

    _buff="$(echo "${_buff}" | sed -e ':a' -e 'N' -e '$!ba' -e "${reg_spe}")"
    _buff="$(echo "${_buff}" | sed "s/ /\[\.SPACE\]/g;")"
    _buff="$(replace_list "$_buff" "num_list")"
    _buff="$(echo "${_buff}" | sed "${special}")"
    _buff="$(replace_list "$_buff" "chr_list")"

    buff="[${_buff:1}]"
}

get_args $@
render
echo "$buff"

